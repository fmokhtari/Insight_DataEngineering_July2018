The source code (named ‘pharmacy_counting.py’) has been written in python, and only needs the library ‘sys’ to get input and output file names from the 'run.sh' shell script. Note that in addition to the descriptions in the following, the source code has been also commented which precisely denotes the function of different sections and subsections of the code. For more information, please see the source code.

To run the source code, please run ‘run.sh’ script in your terminal. In the run.sh script, the input and output file directories have been set to ‘./input/itcont.txt’ and ‘./output/top_cost_drug.txt’. For using a different input or output file name, change them in the ‘run.sh’ shell script. 

The source code includes three main functions: 1) the ProcessChunk function, 2) the ReadLines function and 3) the main function. In the following, it is described how these functions communicate with each other to create the output text file as described in the problem description.

For having an efficient run time for large files, the main function splits the input file to multiple chunks where each chunk includes at most 1E5 lines of the text file. In other words, at each iteration, at most 1E5 lines of the input file is read by ReadLines function. Then, this chunk of the data will be fed to the ProcessChunk function. This function reads the chunk line by line. As data may not be clean, this function first checks a few points for each line to approve that line as a valid sample. The conditions that must be satisfied for approving a line are as follows: 1) the line must include 5 items, and 2) the line cannot include an empty item (noted by (‘’) in python). In addition, in each line of a chunk, I used try/except for updating the values of the dictionary that also checks if the cost of the drug can be converted to a float value. If it is not possible, it indicates that the cost includes either alphabetic or special characters and thus cannot be processed. Please see the code for more details. If either of these conditions is not satisfied, the corresponding line will be rejected (skipped) and the function will continue to read and process the next line. It should be noted that the input data (both itcont.txt and de_cc_data.txt files) indicate that the id of prescribers should be numeric. Also, their first and last names should be normally alphabetic. However, I did not assume any constraints for the id, first and last name of the prescribers, because it will be more general, also no specific constraints have been mentioned in the problem description. 

After processing all the lines of a chunk of the data, ProcessChunk function returns a dictionary variable. The keys of this dictionary are drug names and the values are a list of unique prescribers, number of prescriptions and total cost. Note that in the list of unique prescribers, each prescriber identity is recorded by his/her first and last names, as noted in the problem description. 

At the end of processing each chunk and returning the chunckDict, this data is merged with the totalDict dictionary which is initialized before starting processing the chunks. Similar to chunkDict dictionary, the keys of the totalDict are drug names and the values are a list of unique prescribers, number of prescriptions and total cost (but for the entire data, in contrast to chunkDict which is the dictionary of a chunk of the data). At the end of processing all chunks of the data, the totalDict dictionary is supposed to include the required information of the entire data. 

After processing the chunks and finalizing the totalDict dictionary, this dictionary was sorted based on the total cost in descending order and if there is a tie in total cost of different drugs, it is sorted based on the drug name in ascending order. The sorted data will be recorded in a list variable named drugList. 

The drugList variable will be then used to create the output text file named ‘top_cost_drug.txt’ with the form as explained in the problem description.

